<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="./css/validate.css">
  <title>Document</title>
  <script>
    $(document).on('keydown', '#mobile', function (event) {
        var key = event.charCode || event.keyCode || 0;
            
        if (key !== 8 && key !== 9) {
            if ($(this).val().length === 3) {
                $(this).val($(this).val() + '-');
            }
            if ($(this).val().length === 8) {
                $(this).val($(this).val() + '-');
            }
        }
            
        return (key == 8 || key == 9 || key == 46 || (key >= 48 && key <= 57) || (key >= 96 && key <= 105));
    });
    
    
    
    function registerValid() {
      // 폼 태그 안에 있는 모든 입력 데이터를 회원가입 조건에 맞는지 비교해서 모든 조건에 부합될 경우 true 반환, 아니면 false 반환

      // 아이디 체크
      let idChk = validId($('#userId').val());
      let pwdChk = validPwd($('#pwd').val(), $('#pwdRepeat').val());
      let emailChk = validEmail($('#email').val());
      let phoneNumberChk = validPhoneNumber($('#mobile').val());
      let genderChk = validGender($('input[name=gender]:checked').val())
      let hobbiesArr = importHobbyChecked($('input[name=hobby]:checked').each(val => val));
      let jobChk = validJob($('select#job').val());
      let memo = $('#memo').val();
      let isAgree = ($('#agree').is(':checked')) ? true : false;
      console.log('idChk', idChk, 'pwdChk',pwdChk,'emailChk',emailChk,'phoneNumberChk',phoneNumberChk,'genderChk',genderChk,'hobbiesArr',JSON.stringify(hobbiesArr),'jobChk',jobChk,'memo',memo, 'result',(idChk && pwdChk && emailChk && phoneNumberChk && genderChk && jobChk && isAgree))

      if(idChk && pwdChk && emailChk && phoneNumberChk && genderChk && jobChk && isAgree){
        console.log('return true')
        return true;
      }
    }

    function validId(id) {
      // 아이디 유효성 검사. 아이디가 3자 이하이거나 9자 이상이거나 아무것도 입력하지 않을 경우 에러메시지 출력 후 포커스를 아이디로 맞춘다.
      // 아이디는 4자 이상 8자 이하로 입력해야함.
      if(!id) {
        // 에러메시지 출력 
        outputError($('#userId'), '아이디는 필수 항목 입니다.')
      } else if(id.length <= 3 || id.length >= 9) {
        outputError($('#userId'), '아이디는 4자 이상 ~ 8자 이하로 입력해주십시오.')
      } else {
        return true;
      }

    }

    function validPwd(pwd, repeat) {
      // 비밀번호는 4자이상 12자 이하 필수(비밀번호 확인과 동일해아함.)
      if(!pwd){
        outputError($('#pwd'), '비밀번호는 필수 항목 입니다.');
      } else if(pwd.length <= 3 || pwd.length >= 13){
        outputError($('#pwd'), '비밀번호는 4자 이상 ~ 12자 이하로 입력해주십시오.');
      } else if(pwd !== repeat){
        outputError($('#pwdRepeat'), '비밀번호가 일치하지 않습니다.');
      } else {
        return true;
      }
    }

    function validEmail(email){
      // 이메일 이메일주소 형식인지 아닌지 검사
      const reg = /^[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*\.[a-zA-Z]{2,3}$/i;

      // if(!reg.test(email)){
      if(!email.match(reg)){
        outputError($('#email'), '이메일 형식이 아닙니다.');
      } else {
        return true;
      }
    }

    function validPhoneNumber(phone){
      // 휴대폰 번호 검사
      let reg = /^01([0|1|6|7|8|9]?)-?[0,9]{3,4}-?[0,9]{4}$/;
      debugger
      // if(!reg.test(email)){
      if(phone.length === 0){
        outputError($('#mobile'), '휴대폰 번호를 입력하십시오.');
      } else if(!reg.test(phone)){
        outputError($('#mobile'), '올바른 휴대폰 번호 형식이 아닙니다.');
      } else {
        return true;
      }
    }

    function validGender(gender){
      // 성별은 남성 또는 여성 중 하나가 반드시 체크 되어있어야한다. 
      if(gender == 'male'){
        return true;
      } else if(gender == 'female'){
        return true;
      } else { // 아무것도 체크 안했다면
        outputError($('#female'), '성별은 필수 항목 입니다.');
      }
    }

    function importHobbyChecked(hobby) {
      let arr = [];
      $(hobby).each(function(i, e){
          arr.push(e.value)
      })
      return arr.length > 0 ? arr : '';
    }

    function validJob(job) {
      // debugger
      if(job.includes('직업선택')) {
        outputError($('#job'), '직업은 필수 항목 입니다.');
      } else {
        return true;
      }
    }

    // 에러메시지를 tag다음 요소에 삽입 시켜서 출력하는 함수
    function outputError(obj, msg) {
      let err = `<div class='errMsg'>${msg}</div>`;
      $(err).insertAfter($(obj));
      $('.errMsg').hide(5000)
      
    }
  </script>
  <style>
    .errMsg{
      color: red;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <form action="" style="border:1px solid #ccc">
    <div class="container">
      <h1>회원가입</h1>
      <p>아래의 항목을 기입해 주세요.</p>
      <hr>
  
      <label for="userId"><b>아이디</b></label>
      <input type="text" placeholder="Enter Id" name="userId" id="userId">

      <label for="pwd"><b>비밀번호</b></label>
      <input type="password" placeholder="Enter Password" name="pwd" id="pwd">
  
      <label for="psw-repeat"><b>비밀번호 확인</b></label>
      <input type="password" placeholder="Repeat Password" name="psw-repeat" id="pwdRepeat">
  
      <label for="email"><b>Email</b></label>
      <input type="text" placeholder="Enter Email" name="email" id="email">

      <label for="phoneNumber"><b>전화번호</b></label>
      <input type="text" placeholder="Enter phoneNumber" name="phoneNumber" id="mobile">
      
      <fieldset>
        <legend>성별</legend>
        <div class="form-check">
          <label class="form-check-label" for="male">남성</label>
          <input type="radio" class="form-check-input" id="male" name="gender" value="male">
        </div>
        <div class="form-check">
          <label class="form-check-label" for="female">여성</label>
          <input type="radio" class="form-check-input" id="female" name="gender" value="female">
        </div>
      </fieldset>

      <fieldset>
        <legend>취미</legend>
        <div class="form-check">
          <label class="form-check-label" for="check1">코딩</label>
          <input type="checkbox" class="form-check-input" value="coding" name="hobby" id="check1" value="something" checked>
        </div>
        <div class="form-check">
          <label class="form-check-label" for="check2">알고리즘 문제풀기</label>
          <input type="checkbox" class="form-check-input" value="studyAlgorithm" name="hobby" id="check2" value="something">
        </div>
        <div class="form-check">
          <label class="form-check-label" for="check3">자료구조 공부</label>
          <input type="checkbox" class="form-check-input" value="studyDataStructure" name="hobby" id="check3" >
        </div>
        <div class="form-check">
          <label class="form-check-label" for="check4">개발언어 공부</label>
          <input type="checkbox" class="form-check-input" value="studyLanguage" name="hobby" id="check4" >
        </div>
        <div class="form-check">
          <label class="form-check-label" for="check5">컴퓨터구조 공부</label>
          <input type="checkbox" class="form-check-input" value="studyComputerStructure" name="hobby" id="check5" >
        </div>
      </fieldset>

      <label for="job" class="form-label"><b>직업</b></label>
      <select class="form-select" id="job" name="job">
        <option>---직업선택---</option>
        <option>웹개발자</option>
        <option>앱개발자</option>
        <option>데이터베이스관리자</option>
        <option>퍼블리셔</option>
        <option>디자이너</option>
      </select>
      
      <div class="mb-3 mt-3">
        <label for="comment"><b>메모</b></label>
        <textarea id="memo" name="memo" class="form-control" cols="10" rows="10"></textarea>
      </div>

      <label>
        <input type="checkbox" name="agree" id="agree" style="margin-bottom:15px"> 이용약관 동의
      </label>


      <p>By creating an account you agree to our <a href="#" style="color:dodgerblue">Terms & Privacy</a>.</p>
  
      <div class="clearfix">
        <button type="reset" class="cancelbtn">Cancel</button>
        <button type="button" class="signupbtn" onclick="console.log(registerValid())">Sign Up</button>
      </div>
    </div>
  </form>
</body>
</html>