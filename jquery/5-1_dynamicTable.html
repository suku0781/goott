<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <title>선생님 코드</title>
  <script>
    const clearContents = (arr) => {
      $.each(arr, function (idx, item) {
        $(item).children().val('')
      })
    };

    $(function () {
      // $('.addBtn').click(function () { // 아래의 on('click')이벤트 핸들러와 비교시 .click()은 동적으로 만든 것은 이벤트 핸들러가 동작하지 않는 차이점이 있음. 
      //   let copyTr = $(this).parent().parent(); // 복사할 행을 copyTr에 할당
      //   console.log(copyTr)
      //   let newTr = copyTr.clone(true); // 인자값을 true로 줬을 경우 됨.(깊은 복사) 기본값은 false(얕은 복사)
      //   newTr.insertAfter(copyTr);
      // })
      $('table').on('click', '.addBtn', function() { 
        let copyTr = $(this).parent().parent(); // 복사할 행을 copyTr에 할당
        let newTr = copyTr.clone(); // 인자값을 true로 줬을 경우 됨.(깊은 복사) 기본값은 false(얕은 복사)

        clearContents($(newTr).children()) // 복사된 행의 input 태그 안의 내용을 삭제
        newTr.insertAfter(copyTr);
      });
      $('table').on('click', '.delBtn', function() { 
        ($('tr.target').length > 1) ? $(this).parent().parent().remove() : alert('1개 이상 입력하십시오.');
      });
      $('.send').click('click', function() { 
        let data = new Array();
        // console.log($('tr').eq(1).children().eq(0).children().val())
        $('tr').each(function (idx, item){
          let product = {};
          if(idx > 0){
            // product.prodName = $(item).children().eq(0).children().val();
            // product.prodCnt = $(item).children().eq(1).children().val();
            // product.prodPrc = $(item).children().eq(2).children().val();
            // data.push(product);
            $(item).children().each(function(idx, td){
              if(idx < 3) console.log( $(td).children().attr('name'));
              if(idx < 3) product[$(td).children().attr('name')] = $(td).children().val();
            })
            data.push(product)
          }

        })
        
        console.log('data', data)
        $('#json').html(JSON.stringify(data, null, 3));
      });
    })
  </script>
</head>
<body>
  <table>
    <tr>
      <th>상품명</th>
      <th>수량</th>
      <th>가격</th>
      <th>추가</th>
      <th class="colorRed">삭제</th>
    </tr>
    <tr class="target">
      <td><input type="text" name="prodName"></td>
      <td><input type="text" name="prodCnt"></td>
      <td><input type="text" name="prodPrc"></td>
      <td><input type="button" class="addBtn" value="add"></td>
      <td><input type="button" class="delBtn" value="remove"></td>
    </tr>
  </table>
  <div><button class="send">전송</button></div>
  <textarea id="json" style="width: 300px; height: 300px; resize: none;"></textarea>
</body>
</html>